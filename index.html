<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§µ‡§ø‡§ú‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Æ‡•á‡§ï‡§∞ - Star Digital</title>
    <meta name="description" content="Star Digital ‡§ï‡§æ ‡§´‡•ç‡§∞‡•Ä ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§µ‡§ø‡§ú‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Æ‡•á‡§ï‡§∞‡•§ ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ, ‡§´‡•ã‡§ü‡•ã, ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡§®‡•á ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç‡•§">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for gradients and general look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --primary-color: #007bff; /* Star Digital Blue */
            --dark-bg: #0F4C30; /* Dark Green Background */
            --card-text: #ffffff;
            --card-border-color: #007bff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--card-text);
        }

        /* Input and Button Styling (UPDATED for smaller size) */
        input[type="text"], input[type="email"], input[type="tel"], textarea, input[type="number"] {
            padding: 8px; /* Reduced padding */
            font-size: 0.9rem; /* Slightly smaller font */
            border: 1px solid #444;
            background: #1a643a; /* Darker green background for input */
            color: var(--card-text);
            border-radius: 6px; /* Smaller border radius */
            width: 100%;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }
        
        /* The Card Design (UPDATED for slightly smaller width) */
        #cardPreview {
            width: 280px; 
            height: 170px; 
            margin: 15px auto; 
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            padding: 18px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            transform: scale(1.0); 
            transform-origin: top center;
            
            /* Card Border and Glow Effect */
            border: 2px solid var(--card-border-color); 
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.6), 
                        0 10px 25px rgba(0, 0, 0, 0.5); 
            transition: all 0.3s ease-in-out; 
        }

        #cardPreview:hover {
            transform: scale(1.05); 
            box-shadow: 0 0 25px rgba(0, 123, 255, 0.8), 
                        0 15px 35px rgba(0, 0, 0, 0.7); 
        }
        
        /* --- 3D INITIAL STYLING (REPLACING PROFILE PIC) --- */
        #cardInitial {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px; 
            font-family: 'Dancing Script', cursive; /* Cursive Font */
            font-weight: 700;
            color: white;
            background-color: rgba(255, 255, 255, 0.15); /* Slightly transparent background */
            border: 3px solid white;
            
            /* 3D Text Shadow Effect */
            text-shadow: 
                1px 1px 0 #000, 
                2px 2px 0 var(--primary-color), 
                3px 3px 0 #000;
        }

        .dark-text #cardInitial {
            color: #1e1e2d;
            border: 3px solid #1e1e2d !important;
            background-color: rgba(0, 0, 0, 0.1);
            /* Dark text 3D shadow */
            text-shadow: 
                1px 1px 0 #fff, 
                2px 2px 0 var(--primary-color), 
                3px 3px 0 #fff;
        }
        /* ---------------------------------------------------- */
        
        .name-section {
            display: flex;
            align-items: center;
            gap: 12px; 
        }

        /* Text in the card should use white or a very light color (UPDATED font size) */
        #cardName { font-size: 1.0rem; font-weight: bold; color: white; }
        #cardOccupation { font-size: 0.75rem; font-weight: light; color: white; }
        #cardContact, #cardEmail, #cardLocation { color: #f0f0f0; font-size: 0.8rem; } 

        /* Icon styling */
        .icon {
            width: 15px; 
            height: 15px;
            fill: white; 
            margin-right: 4px;
        }
        
        /* Watermark Styling */
        #cardWatermark {
            position: absolute;
            bottom: 5px; 
            right: 10px;
            font-size: 8px; 
            color: rgba(255, 255, 255, 0.5); 
            font-weight: bold;
            letter-spacing: 0.5px;
            opacity: 0.8;
            pointer-events: none; /* Ensure watermark doesn't interfere with interaction */
        }
        .dark-text #cardWatermark {
            color: rgba(0, 0, 0, 0.5); 
        }

        /* Helper class to ensure card text contrast for lighter backgrounds */
        .dark-text {
            color: #1e1e2d !important;
        }

        /* --- GRADIENT CLASSES (12 Total) --- */
        .grad-1 { background-image: linear-gradient(135deg, #1d976c 0%, #93f9b9 100%); } 
        .grad-2 { background-image: linear-gradient(135deg, #007bff 0%, #6ecbff 100%); } 
        .grad-3 { background-image: linear-gradient(135deg, #d31027 0%, #ea384d 100%); } 
        .grad-4 { background-image: linear-gradient(135deg, #2b5876 0%, #4e4376 100%); } 
        .grad-5 { background-image: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); } 
        .grad-6 { background-image: linear-gradient(135deg, #ff994d 0%, #ff5e3a 100%); } 
        .grad-7 { background-image: linear-gradient(135deg, #f09819 0%, #ff5858 100%); } 
        .grad-8 { background-image: linear-gradient(135deg, #34e89e 0%, #0f3443 100%); } 
        .grad-9 { background-image: linear-gradient(135deg, #8A2387 0%, #E94057 100%); } 
        .grad-10 { background-image: linear-gradient(135deg, #0f0c29 0%, #302b63 100%); } 
        .grad-11 { background-image: linear-gradient(135deg, #cc2b5e 0%, #753a88 100%); } 
        .grad-12 { background-image: linear-gradient(135deg, #ECE9E6 0%, #FFFFFF 100%); } 
    </style>
</head>
<body class="p-4">

    <header class="text-center mb-4">
        <h1 class="text-xl font-extrabold text-white">‚≠êÔ∏è ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§¨‡§ø‡§ú‡§º‡§®‡•á‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§Æ‡•á‡§ï‡§∞</h1>
        <p class="text-xs text-gray-400 mt-1">‡§§‡•Å‡§∞‡§Ç‡§§ ‡§Ö‡§™‡§®‡§æ ‡§µ‡§ø‡§ú‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
    </header>

    <div class="text-center mb-4"> 
        <div id="cardPreview" class="grad-5 card-with-border transition-all duration-300">
            <div class="name-section">
                <div id="cardInitial">A</div> 
                <div>
                    <h2 id="cardName" class="text-xl font-bold leading-tight">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</h2>
                    <p id="cardOccupation" class="text-sm font-light italic leading-tight mt-0.5">‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø</p>
                </div>
                <div id="cardEmoji" class="text-2xl ml-auto">‚ú®</div> 
            </div>

            <div class="mt-4 space-y-1">
                <div class="flex items-center">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C10.74 21 3 13.26 3 4c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.46.57 3.57.11.35.03.74-.24 1.02l-2.2 2.2z"/>
                    </svg>
                    <span id="cardContact">9876543210</span>
                </div>
                <div class="flex items-center">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    <span id="cardEmail">email@example.com</span>
                </div>
                <div class="flex items-center">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span id="cardLocation">‡§∂‡§π‡§∞, 110001</span>
                </div>
            </div>
            
            <div id="cardWatermark">YOURWEBSITE.COM</div>

        </div>
    </div>
    
    <div class="text-center mb-6"> 
        <h3 class="text-sm font-semibold mb-3">üé® ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§ö‡•Å‡§®‡•á‡§Ç (12 ‡§ó‡•ç‡§∞‡•á‡§°‡§ø‡§è‡§Ç‡§ü)</h3> 
        <div id="gradientSelector" class="gradient-selector flex flex-wrap justify-center gap-2"> 
            </div>
    </div>
    
    <div class="max-w-sm mx-auto p-4 bg-gray-800 rounded-lg shadow-lg"> 
        <h3 class="text-lg font-semibold mb-3 text-yellow-300">‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç</h3> 
        <div class="space-y-3"> 
            
            <div>
                <label for="nameInput" class="block text-xs font-medium mb-1">‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ *</label> 
                <input type="text" id="nameInput" placeholder="‡§ú‡•à‡§∏‡•á: ‡§∞‡•ã‡§π‡§ø‡§§ ‡§ï‡•Å‡§Æ‡§æ‡§∞" maxlength="30" value="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
            </div>

            <div class="flex space-x-2">
                <div class="w-1/2">
                    <label for="occupationInput" class="block text-xs font-medium mb-1">‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø</label>
                    <input type="text" id="occupationInput" placeholder="‡§ú‡•à‡§∏‡•á: ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü‡§∞" maxlength="25" value="‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø">
                </div>
                <div class="w-1/2">
                    <label for="emojiInput" class="block text-xs font-medium mb-1">‡§Ü‡§™‡§ï‡§æ ‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ ‡§á‡§Æ‡•ã‡§ú‡•Ä</label>
                    <input type="text" id="emojiInput" placeholder="‡§ú‡•à‡§∏‡•á: üî•, üíº, üí°" maxlength="2" value="‚ú®">
                </div>
            </div>

            <div>
                <label for="contactInput" class="block text-xs font-medium mb-1">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ (‡§ï‡•á‡§µ‡§≤ 10 ‡§Ö‡§Ç‡§ï) *</label>
                <input type="tel" id="contactInput" placeholder="‡§ú‡•à‡§∏‡•á: 9876543210" maxlength="10" value="9876543210">
            </div>
            
            <div>
                <label for="emailInput" class="block text-xs font-medium mb-1">‡§à‡§Æ‡•á‡§≤ ID</label>
                <input type="email" id="emailInput" placeholder="‡§ú‡•à‡§∏‡•á: email@example.com" maxlength="40" value="email@example.com">
            </div>

            <div class="flex space-x-2">
                <div class="w-2/3">
                    <label for="locationInput" class="block text-xs font-medium mb-1">‡§∂‡§π‡§∞/‡§∏‡•ç‡§•‡§æ‡§®</label>
                    <input type="text" id="locationInput" placeholder="‡§ú‡•à‡§∏‡•á: ‡§Æ‡•Å‡§Ç‡§¨‡§à, ‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞" maxlength="20" value="‡§∂‡§π‡§∞">
                </div>
                <div class="w-1/3">
                    <label for="pincodeInput" class="block text-xs font-medium mb-1">‡§™‡§ø‡§® ‡§ï‡•ã‡§°</label>
                    <input type="number" id="pincodeInput" placeholder="‡§ú‡•à‡§∏‡•á: 110001" maxlength="6" value="110001" oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);">
                </div>
            </div>
            
            </div>
    </div>
    
    <div class="max-w-sm mx-auto mt-4 flex space-x-4"> 
        <button id="downloadBtn" onclick="downloadCard()" 
                class="w-1/2 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow-md transition duration-300 flex items-center justify-center text-sm"> 
            üñº ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° JPEG
        </button>
        <button id="shareBtn" onclick="shareCard()" 
                class="w-1/2 py-2 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg shadow-md transition duration-300 flex items-center justify-center text-sm"> 
            üì≤ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
        </button>
    </div>
    
    <div id="customModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-50">
        <div class="bg-gray-700 p-6 rounded-lg max-w-sm w-full shadow-2xl">
            <h3 id="modalTitle" class="text-xl font-bold mb-3 text-yellow-300"></h3>
            <p id="modalMessage" class="text-gray-200 mb-4"></p>
            <button onclick="document.getElementById('customModal').classList.add('hidden')" class="w-full py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                OK
            </button>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION AND DATA ---
        const gradientClasses = [
            'grad-1', 'grad-2', 'grad-3', 'grad-4', 'grad-5', 'grad-6',
            'grad-7', 'grad-8', 'grad-9', 'grad-10', 'grad-11', 'grad-12'
        ];
        
        const lightBackgrounds = ['grad-1', 'grad-2', 'grad-6', 'grad-7', 'grad-12'];

        let currentGradient = 'grad-5';
        let imageUrl = "https://placehold.co/60x60/3b3b4d/ffffff?text=P"; // Now unused, but kept as a placeholder

        // --- 2. DOM ELEMENTS ---
        const elements = {
            preview: document.getElementById('cardPreview'),
            // NEW: Initial element
            initial: document.getElementById('cardInitial'),
            // Photo element removed
            name: document.getElementById('cardName'),
            occupation: document.getElementById('cardOccupation'),
            contact: document.getElementById('cardContact'),
            email: document.getElementById('cardEmail'),
            location: document.getElementById('cardLocation'),
            emoji: document.getElementById('cardEmoji'),
            watermark: document.getElementById('cardWatermark'), // Added watermark element
            
            nameInput: document.getElementById('nameInput'),
            occupationInput: document.getElementById('occupationInput'),
            contactInput: document.getElementById('contactInput'),
            emailInput: document.getElementById('emailInput'),
            locationInput: document.getElementById('locationInput'),
            pincodeInput: document.getElementById('pincodeInput'), 
            emojiInput: document.getElementById('emojiInput'),
            // PhotoInput element removed
            gradientSelector: document.getElementById('gradientSelector'),
            downloadBtn: document.getElementById('downloadBtn'),
            shareBtn: document.getElementById('shareBtn'),
        };
        
        // --- 3. HELPER FUNCTIONS ---

        function showMessage(title, message) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerText = message;
            document.getElementById('customModal').classList.remove('hidden');
        }

        function requiresDarkText(gradient) {
            return lightBackgrounds.includes(gradient);
        }

        function updateCardColorContrast() {
            const isLight = requiresDarkText(currentGradient);
            const textElements = [
                elements.name, elements.occupation, elements.contact, 
                elements.email, elements.location, elements.emoji, elements.watermark
            ];
            
            const iconSVGs = elements.preview.querySelectorAll('.icon');

            // Toggle dark-text class on all relevant elements
            textElements.forEach(el => el.classList.toggle('dark-text', isLight));
            iconSVGs.forEach(svg => svg.style.fill = isLight ? '#1e1e2d' : 'white');
            elements.initial.classList.toggle('dark-text', isLight); // Apply contrast to Initial
        }
        
        // XSS Sanitization Function 
        function sanitizeInput(value) {
            if (!value) return '';
            let sanitized = value.replace(/<\/?[^>]+(>|$)/g, "");
            sanitized = sanitized.replace(/&/g, "&amp;")
                                 .replace(/</g, "&lt;")
                                 .replace(/>/g, "&gt;")
                                 .replace(/"/g, "&quot;")
                                 .replace(/'/g, "&#039;");
            return sanitized;
        }
        
        // NEW: Function to get the first letter of the first word
        function getInitial(name) {
            const sanitizedName = sanitizeInput(name);
            if (!sanitizedName) return 'A';
            const parts = sanitizedName.trim().split(/\s+/);
            if (parts.length > 0) {
                return parts[0].charAt(0).toUpperCase();
            }
            return 'A'; 
        }


        // --- 4. CORE LOGIC: PREVIEW UPDATE ---
        function updatePreview() {
            // Update Text content
            const safeName = sanitizeInput(elements.nameInput.value);
            elements.name.innerText = safeName || "‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ";
            
            // NEW: Update 3D Initial
            elements.initial.innerText = getInitial(safeName);

            elements.occupation.innerText = sanitizeInput(elements.occupationInput.value) || "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø";
            elements.contact.innerText = sanitizeInput(elements.contactInput.value) || "9876543210";
            elements.email.innerText = sanitizeInput(elements.emailInput.value) || "email@example.com";
            
            const locationText = sanitizeInput(elements.locationInput.value) || "‡§∂‡§π‡§∞";
            const pincodeText = elements.pincodeInput.value ? `, ${sanitizeInput(elements.pincodeInput.value)}` : '';
            elements.location.innerText = locationText + pincodeText;
            
            elements.emoji.innerText = sanitizeInput(elements.emojiInput.value).slice(0, 2) || "‚ú®"; 

            // Update Card Gradient and Contrast
            elements.preview.className = `grad-${currentGradient.slice(5)} transition-all duration-300`;
            elements.preview.classList.add('transition-all', 'duration-300', 'card-with-border'); 
            updateCardColorContrast();
        }

        // --- 5. INITIALIZATION ---
        function initialize() {
            const inputFields = [
                elements.nameInput, elements.occupationInput, elements.contactInput,
                elements.emailInput, elements.locationInput, elements.emojiInput, elements.pincodeInput 
            ];
            inputFields.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            elements.pincodeInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                updatePreview();
            });

            // Initialize Gradient Selector
            gradientClasses.forEach(grad => {
                const btn = document.createElement('button');
                btn.className = grad;
                btn.classList.add('grad-button');
                btn.setAttribute('data-grad', grad);
                btn.onclick = () => selectGradient(grad);
                elements.gradientSelector.appendChild(btn);
            });

            selectGradient(currentGradient);

            updatePreview();
        }
        
        function selectGradient(grad) {
            currentGradient = grad;
            elements.gradientSelector.querySelectorAll('.grad-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-grad="${grad}"]`).classList.add('selected');
            updatePreview();
        }


        // --- 6. ACTION FUNCTIONS (DOWNLOAD & SHARE) ---

        function processCardCapture(action) {
            // 1. Validation
            const contactNumber = elements.contactInput.value;
            if (!elements.nameInput.value) {
                showMessage("‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä", "‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç‡•§");
                return;
            }
            if (!contactNumber || contactNumber.length !== 10 || isNaN(contactNumber)) {
                showMessage("‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä", "‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç‡•§");
                return;
            }

            // 2. Prepare for Capture
            const card = elements.preview;
            const originalTransform = card.style.transform;
            const originalMargin = card.style.margin;
            
            card.style.transform = 'none';
            card.style.margin = '0';
            
            elements.downloadBtn.disabled = true;
            elements.shareBtn.disabled = true;

            html2canvas(card, { 
                scale: 2.5, // JPEG scale
                useCORS: true, 
                allowTaint: true 
            }).then(canvas => {
                // 3. Restore original styles
                card.style.transform = originalTransform;
                card.style.margin = originalMargin;
                elements.downloadBtn.disabled = false;
                elements.shareBtn.disabled = false;

                const name = sanitizeInput(elements.nameInput.value).replace(/\s/g, '_');
                const filename = `Digital_Card_${name}.jpg`; 

                if (action === 'download') {
                    // Download Logic
                    let link = document.createElement("a");
                    link.download = filename;
                    link.href = canvas.toDataURL('image/jpeg', 0.9); 
                    link.click();
                    showMessage("‡§∏‡§´‡§≤‡§§‡§æ!", "‡§Ü‡§™‡§ï‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§° JPEG ‡§á‡§Æ‡•á‡§ú ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§");

                } else if (action === 'share') {
                    // Share Logic
                    canvas.toBlob(function(blob) {
                        if (navigator.share) {
                            const file = new File([blob], filename, { type: 'image/jpeg' }); 
                            const shareText = `‡§Æ‡•á‡§∞‡§æ ‡§®‡§Ø‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§µ‡§ø‡§ú‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§°! ‡§¶‡•á‡§ñ‡§ø‡§è ‡§Æ‡•á‡§∞‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏‡•§ ‡§Æ‡•à‡§Ç‡§®‡•á ‡§á‡§∏‡•á Star Digital ‡§ï‡•á ‡§´‡•ç‡§∞‡•Ä ‡§ü‡•Ç‡§≤ ‡§∏‡•á ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§π‡•à‡•§`;
                            
                            navigator.share({
                                title: 'Digital Business Card',
                                text: shareText,
                                files: [file],
                            }).catch((error) => {
                                console.log('Error sharing:', error);
                                showMessage("‡§∂‡•á‡§Ø‡§∞‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§´‡§≤", "‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§™‡§∞ ‡§∂‡•á‡§Ø‡§∞‡§ø‡§Ç‡§ó ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§á‡§Æ‡•á‡§ú ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡•Ä‡•§");
                                fallbackDownload(canvas, filename);
                            });
                        } else {
                            showMessage("‡§∂‡•á‡§Ø‡§∞‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§´‡§≤", "‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ Share API ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§Æ‡•á‡§ú ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡•Ä‡•§");
                            fallbackDownload(canvas, filename);
                        }
                    }, 'image/jpeg'); 
                }
            });
        }
        
        function fallbackDownload(canvas, filename) {
            let link = document.createElement("a");
            link.download = filename;
            link.href = canvas.toDataURL('image/jpeg', 0.9); 
            link.click();
        }

        function downloadCard() {
            processCardCapture('download');
        }

        function shareCard() {
            processCardCapture('share');
        }

        // Initialize the app when the window loads
        window.onload = initialize;

    </script>

</body>
</html>
